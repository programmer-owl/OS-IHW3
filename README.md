# Макаревич Мария, БПИ228
Индивидуальное домашнее задание 3 по дисциплине "Операционные системы". **Работа выполнена на ?????????????????????? баллов.**
## Вариант 3
Задача о Винни-Пухе– 2 или неправильные пчелы. N пчел живет в улье. Каждая пчела может собирать мед или сторожить улей (N > 3). Пчела не покинет улей, если кроме нее в нем нет других пчел. Каждая пчела приносит за раз одну порцию меда. Всего в улей может войти тридцать порций меда. Вини-Пух спит пока меда в улье меньше половины, но как только его становится достаточно, он просыпается и пытается достать весь мед из улья. Если в улье находится меньше трех пчел, Вини-Пух забирает мед, убегает, съедает мед и снова засыпает. Если пчел три или больше, то они кусают Винни-Пуха, он убегает, лечит укус некоторое время, а затем снова бежит за медом.
Создать клиент–серверное приложение, моделирующее поведение пчел и медведя. Медведя и улей с пчелами представить в виде отдельных клиентов. Сервер обрабатывает поступающие от них сообщения и передает их клиентам в соответствии с установленными выше правилами.
## 4-5 баллов
### Алгоритм решения
В программе присутствуют 3 файла: сервер, клиент, олицетворяющий улей, и клиент, олицетворяющий Винни Пуха. Количество пчел в улье задается пользователем через командуую строку для файлов сервера и улья. Каждую пчелу олицетворяет отдельный процесс-ребенок. Все они запускаются в одном файле улья с помощью команды fork(). Тестировать программу удобнее всего при количестве пчел, равном 4. При неверном формате или содержании аргументов пользователю выводится сообщение об ошибке.

В программе улья используется объект разделяемой памяти, хранящий информацию о honey_portions - количестве порций меда в улье, а также именованный семафор bees, отвечающий за количество пчел, которые могут покинуть улей. Отметим, что из семафора bees можно также понять количество пчел, находящихся в улье, - оно равно значению семафора, увеличенному на 1, - что нужно для алгоритма кражи меда.

Пчелы на протяжении всей работы программы вылетают из улья, если у них есть такая возможность (т.е. bees != 0), через некоторое время (реализуемое вызовом команды sleep()) возвращаются в улей с медом, пополняют его запасы в улье, то есть увеличивают honey_portions, если это возможно, и на какое-то время остаются в улье, после чего процесс повторяется снова. Винни Пух наблюдает за ульем и, когда в улье накапливается достаточное количество меда (то есть honey_portions становится больше или равно 15), пытается украсть его. Далее, в зависимости от количества пчел в улье, получаемом из значения семафора bees, Винни либо опустошает улей, приравнивая honey_portions к 0, либо, покусанный пчелами, уходит лечиться, после чего процесс повторяется снова.

Взаимодействие между Винни и ульем происходит через сервер: медведь периодически посылает на сервер запросы о состоянии улья, а улей раз в определенное время (5 секунд) обновляет на сервере информацию о своем состоянии. Для передачи информации между сервером и клиентами используется протокол TCP. Адреса сервера и портов, как и количество пчел, передаются через командную строку: <Number of bees greater than 3> <Server Port\> для server.c, <Server IP\> <Number of bees greater than 3> \[<Echo Port\>] для hive.c и <Server IP\> \[<Echo Port\>] для bear.c.

В программе предусмотрено ее корректное завершение с удалением разделяемой памяти и семафоров по прерыванию с клавиатуры, то есть при команде SIGINT.
### Пример работы программы
**server.c**

![image](https://github.com/programmer-owl/OS-IHW3/assets/131264233/7d0c9af9-c062-4bf3-8c55-e732dfc31cc9)

**hive.c**

![image](https://github.com/programmer-owl/OS-IHW3/assets/131264233/b4454dd4-e6ed-454d-b71a-dc3dc706d512)

\*еще много выводов, пропустим их и перейдем к чему-то интересному - краже меда\*

![image](https://github.com/programmer-owl/OS-IHW3/assets/131264233/985cbd3e-83ce-4d59-9010-d8a04886a222)

**bear.c**

![image](https://github.com/programmer-owl/OS-IHW3/assets/131264233/df27015f-9e2e-4c86-8e03-0f2f58b4e371)

## 6-7 баллов
### Алгоритм решения
В программу добавлен файл monitor.c, выводящий в консоль все присходящие события, о которых ему сообщает сервер. Его слудеут вызывать с аргументами в командой строке: <Server IP\> \[<Echo Port\>]. При этом вывод информации о пчелах сокращен, ибо на предыдущем пункте я поняла, что ее слишком много, и это сбивает пользователя. Я заменила вывод информации в программе сервера на вывод ее в программе монитора, а также добавила к ней информацию о состоянии улья. Основные модификации были проведены с файлом server.c, в котором вызовы функции printf были заменены на отправку сообщений монитору.
### Пример работы программы
**monitor.c**

![image](https://github.com/programmer-owl/OS-IHW3/assets/131264233/10e99400-2fa1-48c7-a94f-b7925b57b571)

